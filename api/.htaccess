<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Разрешаем доступ только к send-email.php
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ send-email.php [L]
</IfModule>

<IfModule mod_headers.c>
    # Настройки CORS для API
    SetEnvIf Origin "^(https?://(www\.)?xn----9sb8ajp\.xn--p1ai)$" allowed_origin=$0
    Header always set Access-Control-Allow-Origin "%{allowed_origin}e" env=allowed_origin
    Header always set Access-Control-Allow-Methods "POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Origin, X-Requested-With"
    Header always set Access-Control-Allow-Credentials "true"
</IfModule>

# Обработка preflight OPTIONS запросов для API
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Запретить доступ к .env файлам
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

# Запретить доступ к composer файлам
<Files "composer.*">
    Order allow,deny
    Deny from all
</Files>

# Запретить доступ к служебным файлам
<FilesMatch "^(\.htaccess|\.gitignore|README\.md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Запретить листинг директорий
Options -Indexes

# Устанавливаем правильные Content-Type для PHP файлов
<Files "*.php">
    SetHandler application/x-httpd-php
</Files>

# Защищаем от распространенных атак
<IfModule mod_security.c>
    SecFilterEngine Off
    SecFilterScanPOST Off
</IfModule>

# Устанавливаем кодировку по умолчанию
AddDefaultCharset UTF-8